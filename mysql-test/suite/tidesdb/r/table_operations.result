#
# TidesDB Table Operations Tests
#
# Tests for:
# - RENAME TABLE
# - TRUNCATE TABLE
# - CHECK TABLE
# - REPAIR TABLE
# - OPTIMIZE TABLE
# - ANALYZE TABLE
#
DROP TABLE IF EXISTS tidesdb_check;
# Test 1: RENAME TABLE
CREATE TABLE t1 (
id INT PRIMARY KEY,
name VARCHAR(100)
) ENGINE=TidesDB;
INSERT INTO t1 VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Charlie');
SELECT * FROM t1 ORDER BY id;
id	name
1	Alice
2	Bob
3	Charlie
RENAME TABLE t1 TO t1_renamed;
SELECT * FROM t1_renamed ORDER BY id;
id	name
1	Alice
2	Bob
3	Charlie
# Verify old table doesn't exist
SELECT * FROM t1;
ERROR 42S02: Table 'test.t1' doesn't exist
RENAME TABLE t1_renamed TO t1;
SELECT * FROM t1 ORDER BY id;
id	name
1	Alice
2	Bob
3	Charlie
# Test 2: TRUNCATE TABLE
INSERT INTO t1 VALUES (4, 'David'), (5, 'Eve');
SELECT COUNT(*) FROM t1;
COUNT(*)
5
TRUNCATE TABLE t1;
SELECT COUNT(*) FROM t1;
COUNT(*)
0
# Verify auto-increment resets after TRUNCATE
INSERT INTO t1 VALUES (1, 'New First');
SELECT * FROM t1;
id	name
1	New First
# Test 3: CHECK TABLE
DROP TABLE t1;
CREATE TABLE t1 (
id INT PRIMARY KEY,
name VARCHAR(100),
INDEX idx_name (name)
) ENGINE=TidesDB;
Warnings:
Note	1071	Specified key was too long; max key length is 255 bytes
INSERT INTO t1 VALUES (1, 'Alice'), (2, 'Bob'), (3, 'Charlie');
CHECK TABLE t1;
Table	Op	Msg_type	Msg_text
test.t1	check	status	OK
# Test 4: REPAIR TABLE
REPAIR TABLE t1;
Table	Op	Msg_type	Msg_text
test.t1	repair	status	OK
# Test 5: OPTIMIZE TABLE
OPTIMIZE TABLE t1;
Table	Op	Msg_type	Msg_text
test.t1	optimize	status	OK
# Test 6: ANALYZE TABLE
ANALYZE TABLE t1;
Table	Op	Msg_type	Msg_text
test.t1	analyze	status	Engine-independent statistics collected
test.t1	analyze	status	OK
# Verify data is still intact after maintenance operations
SELECT * FROM t1 ORDER BY id;
id	name
1	Alice
2	Bob
3	Charlie
# Cleanup
DROP TABLE t1;
#
# Table operations tests completed!
#
