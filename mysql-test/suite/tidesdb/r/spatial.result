#
# TidesDB Spatial/Geometry Tests
#
DROP TABLE IF EXISTS tidesdb_check;
# Test 1: Create table with POINT geometry
CREATE TABLE t1 (
id INT PRIMARY KEY,
name VARCHAR(100),
location POINT
) ENGINE=TidesDB;
# Test 2: Insert POINT data
INSERT INTO t1 VALUES (1, 'New York', ST_GeomFromText('POINT(-74.006 40.7128)'));
INSERT INTO t1 VALUES (2, 'Los Angeles', ST_GeomFromText('POINT(-118.2437 34.0522)'));
INSERT INTO t1 VALUES (3, 'Chicago', ST_GeomFromText('POINT(-87.6298 41.8781)'));
SELECT id, name, ST_AsText(location) AS location FROM t1 ORDER BY id;
id	name	location
1	New York	POINT(-74.006 40.7128)
2	Los Angeles	POINT(-118.2437 34.0522)
3	Chicago	POINT(-87.6298 41.8781)
# Test 3: Create table with various geometry types
CREATE TABLE t2 (
id INT PRIMARY KEY,
geom_point POINT,
geom_line LINESTRING,
geom_poly POLYGON
) ENGINE=TidesDB;
INSERT INTO t2 VALUES (
1,
ST_GeomFromText('POINT(0 0)'),
ST_GeomFromText('LINESTRING(0 0, 1 1, 2 2)'),
ST_GeomFromText('POLYGON((0 0, 10 0, 10 10, 0 10, 0 0))')
);
SELECT id, 
ST_AsText(geom_point) AS point,
ST_AsText(geom_line) AS line,
ST_AsText(geom_poly) AS polygon
FROM t2;
id	point	line	polygon
1	POINT(0 0)	LINESTRING(0 0,1 1,2 2)	POLYGON((0 0,10 0,10 10,0 10,0 0))
# Test 4: Spatial functions - distance calculation
SELECT 
a.name AS city1,
b.name AS city2,
ROUND(ST_Distance(a.location, b.location), 4) AS distance
FROM t1 a, t1 b
WHERE a.id < b.id
ORDER BY a.id, b.id;
city1	city2	distance
New York	Los Angeles	44.7363
Los Angeles	Chicago	31.5983
# Test 5: GEOMETRY column type
CREATE TABLE t3 (
id INT PRIMARY KEY,
name VARCHAR(100),
shape GEOMETRY
) ENGINE=TidesDB;
INSERT INTO t3 VALUES (1, 'point', ST_GeomFromText('POINT(1 1)'));
INSERT INTO t3 VALUES (2, 'line', ST_GeomFromText('LINESTRING(0 0, 5 5)'));
INSERT INTO t3 VALUES (3, 'polygon', ST_GeomFromText('POLYGON((0 0, 5 0, 5 5, 0 5, 0 0))'));
SELECT id, name, ST_GeometryType(shape) AS type, ST_AsText(shape) AS shape FROM t3 ORDER BY id;
id	name	type	shape
1	point	POINT	POINT(1 1)
2	line	LINESTRING	LINESTRING(0 0,5 5)
3	polygon	POLYGON	POLYGON((0 0,5 0,5 5,0 5,0 0))
# Test 6: Spatial predicates
CREATE TABLE t4 (
id INT PRIMARY KEY,
name VARCHAR(50),
bounds POLYGON
) ENGINE=TidesDB;
INSERT INTO t4 VALUES (1, 'Region A', ST_GeomFromText('POLYGON((0 0, 10 0, 10 10, 0 10, 0 0))'));
INSERT INTO t4 VALUES (2, 'Region B', ST_GeomFromText('POLYGON((5 5, 15 5, 15 15, 5 15, 5 5))'));
# Test 7: Check if point is within polygon
SET @test_point = ST_GeomFromText('POINT(5 5)');
SELECT id, name, ST_Contains(bounds, @test_point) AS contains_point FROM t4 ORDER BY id;
id	name	contains_point
1	Region A	1
2	Region B	1
# Test 8: Spatial data with index
CREATE TABLE t5 (
id INT PRIMARY KEY,
location POINT NOT NULL,
description VARCHAR(100)
) ENGINE=TidesDB;
INSERT INTO t5 VALUES (1, ST_GeomFromText('POINT(0 0)'), 'Origin');
INSERT INTO t5 VALUES (2, ST_GeomFromText('POINT(1 1)'), 'Point 1');
INSERT INTO t5 VALUES (3, ST_GeomFromText('POINT(2 2)'), 'Point 2');
INSERT INTO t5 VALUES (4, ST_GeomFromText('POINT(3 3)'), 'Point 3');
SELECT id, description, ST_AsText(location) FROM t5 ORDER BY id;
id	description	ST_AsText(location)
1	Origin	POINT(0 0)
2	Point 1	POINT(1 1)
3	Point 2	POINT(2 2)
4	Point 3	POINT(3 3)
# Test 9: Update geometry data
UPDATE t1 SET location = ST_GeomFromText('POINT(-73.9857 40.7484)') WHERE id = 1;
SELECT id, name, ST_AsText(location) FROM t1 WHERE id = 1;
id	name	ST_AsText(location)
1	New York	POINT(-73.9857 40.7484)
# Test 10: Delete geometry data
DELETE FROM t1 WHERE id = 3;
SELECT COUNT(*) FROM t1;
COUNT(*)
3
# Cleanup
DROP TABLE t1, t2, t3, t4, t5;
#
# Spatial tests completed!
#
