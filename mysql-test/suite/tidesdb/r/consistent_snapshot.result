#
# Test START TRANSACTION WITH CONSISTENT SNAPSHOT
#
DROP TABLE tidesdb_check;
CREATE TABLE t1 (
id INT PRIMARY KEY,
value VARCHAR(100)
) ENGINE=TidesDB;
INSERT INTO t1 VALUES (1, 'initial');
# Test 1: Basic consistent snapshot
START TRANSACTION WITH CONSISTENT SNAPSHOT;
SELECT * FROM t1;
id	value
1	initial
COMMIT;
# Test 2: Consistent snapshot isolation
connect  con1, localhost, root,,;
connection con1;
START TRANSACTION WITH CONSISTENT SNAPSHOT;
SELECT * FROM t1 WHERE id = 1;
id	value
1	initial
connection default;
UPDATE t1 SET value = 'updated' WHERE id = 1;
connection con1;
SELECT * FROM t1 WHERE id = 1;
id	value
1	updated
COMMIT;
SELECT * FROM t1 WHERE id = 1;
id	value
1	updated
disconnect con1;
connection default;
# Test 3: Multiple tables with consistent snapshot
CREATE TABLE t2 (
id INT PRIMARY KEY,
data VARCHAR(100)
) ENGINE=TidesDB;
INSERT INTO t2 VALUES (1, 'table2_data');
START TRANSACTION WITH CONSISTENT SNAPSHOT;
SELECT * FROM t1;
id	value
1	updated
SELECT * FROM t2;
id	data
1	table2_data
COMMIT;
# Cleanup
DROP TABLE t1, t2;
#
# Consistent snapshot tests completed!
#
