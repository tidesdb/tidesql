#
# ANALYZE TABLE for TidesDB -- verifies CF stats output
#
CREATE TABLE t1 (
id INT PRIMARY KEY,
val VARCHAR(40),
KEY idx_val (val)
) ENGINE=TidesDB;
INSERT INTO t1 VALUES (1, 'alpha'), (2, 'bravo'), (3, 'charlie'),
(4, 'delta'), (5, 'echo'),  (6, 'foxtrot');
# ANALYZE TABLE should return status OK and emit CF stats as notes.
# Mask volatile numeric values (memtable size, avg sizes, etc.)
ANALYZE TABLE t1;
Table	Op	Msg_type	Msg_text
test.t1	analyze	status	Engine-independent statistics collected
test.t1	analyze	Note	TIDESDB: CF 'test__t1'  total_keys=N  data_size=N bytes  memtable=N bytes  levels=5  read_amp=N  cache_hit=N%
test.t1	analyze	Note	TIDESDB: avg_key=N bytes  avg_value=N bytes
test.t1	analyze	Note	TIDESDB: level 1  sstables=N  size=N bytes  keys=N
test.t1	analyze	Note	TIDESDB: level 2  sstables=N  size=N bytes  keys=N
test.t1	analyze	Note	TIDESDB: level 3  sstables=N  size=N bytes  keys=N
test.t1	analyze	Note	TIDESDB: level 4  sstables=N  size=N bytes  keys=N
test.t1	analyze	Note	TIDESDB: level 5  sstables=N  size=N bytes  keys=N
test.t1	analyze	Note	TIDESDB: idx CF 'test__t1__idx_idx_val'  keys=N  data_size=N bytes  levels=5
test.t1	analyze	status	OK
# ANALYZE a table without secondary indexes
CREATE TABLE t2 (
id INT PRIMARY KEY,
data VARCHAR(200)
) ENGINE=TidesDB;
INSERT INTO t2 VALUES (1, REPEAT('x', 100)), (2, REPEAT('y', 100));
ANALYZE TABLE t2;
Table	Op	Msg_type	Msg_text
test.t2	analyze	status	Engine-independent statistics collected
test.t2	analyze	Note	TIDESDB: CF 'test__t2'  total_keys=N  data_size=N bytes  memtable=N bytes  levels=5  read_amp=N  cache_hit=N%
test.t2	analyze	Note	TIDESDB: avg_key=N bytes  avg_value=N bytes
test.t2	analyze	Note	TIDESDB: level 1  sstables=N  size=N bytes  keys=N
test.t2	analyze	Note	TIDESDB: level 2  sstables=N  size=N bytes  keys=N
test.t2	analyze	Note	TIDESDB: level 3  sstables=N  size=N bytes  keys=N
test.t2	analyze	Note	TIDESDB: level 4  sstables=N  size=N bytes  keys=N
test.t2	analyze	Note	TIDESDB: level 5  sstables=N  size=N bytes  keys=N
test.t2	analyze	status	OK
# ANALYZE an empty table
CREATE TABLE t3 (
id INT PRIMARY KEY
) ENGINE=TidesDB;
ANALYZE TABLE t3;
Table	Op	Msg_type	Msg_text
test.t3	analyze	status	Engine-independent statistics collected
test.t3	analyze	Note	TIDESDB: CF 'test__t3'  total_keys=N  data_size=N bytes  memtable=N bytes  levels=5  read_amp=N  cache_hit=N%
test.t3	analyze	Note	TIDESDB: avg_key=N bytes  avg_value=N bytes
test.t3	analyze	Note	TIDESDB: level 1  sstables=N  size=N bytes  keys=N
test.t3	analyze	Note	TIDESDB: level 2  sstables=N  size=N bytes  keys=N
test.t3	analyze	Note	TIDESDB: level 3  sstables=N  size=N bytes  keys=N
test.t3	analyze	Note	TIDESDB: level 4  sstables=N  size=N bytes  keys=N
test.t3	analyze	Note	TIDESDB: level 5  sstables=N  size=N bytes  keys=N
test.t3	analyze	status	OK
# Cleanup
DROP TABLE t1, t2, t3;
