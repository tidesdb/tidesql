#
# TidesDB Sequential Scan Prefetch (HA_EXTRA_CACHE) Tests
#
DROP TABLE IF EXISTS tidesdb_check;
# Test 1: Full table scan triggers prefetch (HA_EXTRA_CACHE)
CREATE TABLE t1 (
id INT PRIMARY KEY,
data VARCHAR(255)
) ENGINE=TidesDB;
# Full scan -- optimizer sends HA_EXTRA_CACHE before scan
SELECT COUNT(*) FROM t1;
COUNT(*)
500
SELECT COUNT(*) FROM t1 WHERE data LIKE 'prefetch_data_25%';
COUNT(*)
10
# Test 2: Prefetch with ORDER BY (filesort triggers cache hint)
SELECT * FROM t1 ORDER BY data LIMIT 5;
id	data
1	prefetch_data_1
10	prefetch_data_10
100	prefetch_data_100
101	prefetch_data_101
102	prefetch_data_102
# Test 3: Prefetch with aggregate scan
SELECT MIN(id), MAX(id), AVG(id) FROM t1;
MIN(id)	MAX(id)	AVG(id)
1	255	250.4890
# Test 4: Prefetch with JOIN (nested loop full scan)
CREATE TABLE t2 (
id INT PRIMARY KEY,
ref_id INT
) ENGINE=TidesDB;
INSERT INTO t2 VALUES (1, 100), (2, 200), (3, 300);
SELECT t2.id, t1.data FROM t2 JOIN t1 ON t1.id = t2.ref_id ORDER BY t2.id;
id	data
1	prefetch_data_100
2	prefetch_data_200
3	prefetch_data_300
# Test 5: Prefetch with subquery scan
SELECT * FROM t2 WHERE ref_id IN (SELECT id FROM t1 WHERE id <= 3) ORDER BY id;
id	ref_id
# Cleanup
DROP TABLE t1, t2;
#
# Prefetch cache tests completed!
#
