#
# TidesDB Index Operations Tests
#
DROP TABLE IF EXISTS tidesdb_check;
# Test 1: Create table with index
CREATE TABLE t1 (
id INT PRIMARY KEY,
name VARCHAR(100),
value INT,
INDEX idx_name (name),
INDEX idx_value (value)
) ENGINE=TidesDB;
Warnings:
Note	1071	Specified key was too long; max key length is 255 bytes
INSERT INTO t1 VALUES (1, 'Alice', 100);
INSERT INTO t1 VALUES (2, 'Bob', 200);
INSERT INTO t1 VALUES (3, 'Charlie', 150);
INSERT INTO t1 VALUES (4, 'David', 300);
INSERT INTO t1 VALUES (5, 'Eve', 250);
# Test 2: index_first - Get first row via index
SELECT * FROM t1 USE INDEX (idx_value) ORDER BY value LIMIT 1;
id	name	value
1	Alice	100
# Test 3: index_last - Get last row via index  
SELECT * FROM t1 USE INDEX (idx_value) ORDER BY value DESC LIMIT 1;
id	name	value
4	David	300
# Test 4: index_next - Sequential index scan
SELECT * FROM t1 USE INDEX (idx_value) WHERE value >= 150 ORDER BY value;
id	name	value
3	Charlie	150
2	Bob	200
5	Eve	250
4	David	300
# Test 5: index_prev - Reverse index scan
SELECT * FROM t1 USE INDEX (idx_value) WHERE value <= 250 ORDER BY value DESC;
id	name	value
5	Eve	250
2	Bob	200
3	Charlie	150
1	Alice	100
# Test 6: index_read with different find flags
SELECT * FROM t1 WHERE name = 'Charlie';
id	name	value
3	Charlie	150
SELECT * FROM t1 USE INDEX (idx_name) WHERE name >= 'C' ORDER BY name LIMIT 3;
id	name	value
3	Charlie	150
4	David	300
5	Eve	250
SELECT * FROM t1 USE INDEX (idx_name) WHERE name <= 'C' ORDER BY name DESC LIMIT 3;
id	name	value
2	Bob	200
1	Alice	100
# Test 7: index_next_same - Multiple rows with same key
CREATE TABLE t2 (
id INT PRIMARY KEY,
category VARCHAR(50),
item VARCHAR(100),
INDEX idx_category (category)
) ENGINE=TidesDB;
INSERT INTO t2 VALUES (1, 'Electronics', 'Phone');
INSERT INTO t2 VALUES (2, 'Electronics', 'Laptop');
INSERT INTO t2 VALUES (3, 'Electronics', 'Tablet');
INSERT INTO t2 VALUES (4, 'Clothing', 'Shirt');
INSERT INTO t2 VALUES (5, 'Clothing', 'Pants');
SELECT * FROM t2 WHERE category = 'Electronics' ORDER BY id;
id	category	item
1	Electronics	Phone
2	Electronics	Laptop
3	Electronics	Tablet
# Test 8: Range scan with BETWEEN
SELECT * FROM t1 WHERE value BETWEEN 150 AND 250 ORDER BY value;
id	name	value
3	Charlie	150
2	Bob	200
5	Eve	250
# Test 9: Index with ORDER BY
SELECT * FROM t1 ORDER BY name;
id	name	value
1	Alice	100
2	Bob	200
3	Charlie	150
4	David	300
5	Eve	250
SELECT * FROM t1 ORDER BY value DESC;
id	name	value
4	David	300
5	Eve	250
2	Bob	200
3	Charlie	150
1	Alice	100
# Test 10: Index with LIMIT
SELECT * FROM t1 ORDER BY value LIMIT 3;
id	name	value
1	Alice	100
3	Charlie	150
2	Bob	200
SELECT * FROM t1 ORDER BY value DESC LIMIT 2;
id	name	value
4	David	300
5	Eve	250
# Test 11: Covering index (index-only scan)
SELECT name FROM t1 WHERE name LIKE 'A%';
name
Alice
SELECT value FROM t1 WHERE value > 200;
value
250
300
# Cleanup
DROP TABLE t1, t2;
#
# Index operations tests completed!
#
