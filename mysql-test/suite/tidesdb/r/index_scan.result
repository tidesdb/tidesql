#
# TidesDB index scan tests
#
#
# Test 1: Primary key ordered scan
#
CREATE TABLE t1 (
id INT PRIMARY KEY,
val VARCHAR(50)
) ENGINE=TidesDB;
INSERT INTO t1 VALUES (5, 'five'), (1, 'one'), (3, 'three'), (2, 'two'), (4, 'four');
# Should return rows in primary key order
SELECT * FROM t1 ORDER BY id;
id	val
1	one
2	two
3	three
4	four
5	five
# Reverse order
SELECT * FROM t1 ORDER BY id DESC;
id	val
5	five
4	four
3	three
2	two
1	one
DROP TABLE t1;
#
# Test 2: Secondary index ordered scan
#
CREATE TABLE t2 (
id INT PRIMARY KEY,
name VARCHAR(50),
INDEX idx_name (name)
) ENGINE=TidesDB;
INSERT INTO t2 VALUES (1, 'charlie'), (2, 'alice'), (3, 'bob'), (4, 'david'), (5, 'eve');
# Should return rows in name order using index
SELECT id, name FROM t2 ORDER BY name;
id	name
1	charlie
3	bob
4	david
5	eve
# Range scan on secondary index
SELECT id, name FROM t2 WHERE name >= 'bob' AND name <= 'david' ORDER BY name;
id	name
3	bob
DROP TABLE t2;
#
# Test 3: Index scan with LIMIT
#
CREATE TABLE t3 (
id INT PRIMARY KEY,
score INT,
INDEX idx_score (score)
) ENGINE=TidesDB;
INSERT INTO t3 VALUES (1, 100), (2, 50), (3, 75), (4, 25), (5, 90);
# Top 3 scores
SELECT id, score FROM t3 ORDER BY score DESC LIMIT 3;
id	score
5	90
4	25
3	75
# Bottom 2 scores
SELECT id, score FROM t3 ORDER BY score LIMIT 2;
id	score
1	100
3	75
DROP TABLE t3;
#
# Test 4: Composite index scan
#
CREATE TABLE t4 (
id INT PRIMARY KEY,
category VARCHAR(20),
price DECIMAL(10,2),
INDEX idx_cat_price (category, price)
) ENGINE=TidesDB;
INSERT INTO t4 VALUES 
(1, 'electronics', 299.99),
(2, 'electronics', 99.99),
(3, 'books', 19.99),
(4, 'books', 29.99),
(5, 'electronics', 199.99);
# Scan by category and price
SELECT id, category, price FROM t4 WHERE category = 'electronics' ORDER BY price;
id	category	price
2	electronics	99.99
5	electronics	199.99
1	electronics	299.99
# All items ordered by category, then price
SELECT id, category, price FROM t4 ORDER BY category, price;
id	category	price
1	electronics	299.99
3	books	19.99
4	books	29.99
5	electronics	199.99
DROP TABLE t4;
#
# Test 5: Index scan after updates
#
CREATE TABLE t5 (
id INT PRIMARY KEY,
val INT,
INDEX idx_val (val)
) ENGINE=TidesDB;
INSERT INTO t5 VALUES (1, 10), (2, 20), (3, 30);
# Before update
SELECT * FROM t5 ORDER BY val;
id	val
1	10
3	30
UPDATE t5 SET val = 25 WHERE id = 1;
# After update - order should change
SELECT * FROM t5 ORDER BY val;
id	val
1	25
3	30
DROP TABLE t5;
#
# Index scan tests completed!
#
