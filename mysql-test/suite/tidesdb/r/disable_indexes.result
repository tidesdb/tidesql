#
# TidesDB Disable/Enable Indexes for Bulk Load
#
DROP TABLE IF EXISTS tidesdb_check;
# Test 1: Disable keys, bulk insert, enable keys
CREATE TABLE t1 (
id INT PRIMARY KEY,
name VARCHAR(100),
value INT,
INDEX idx_name (name),
INDEX idx_value (value)
) ENGINE=TidesDB;
Warnings:
Note	1071	Specified key was too long; max key length is 255 bytes
# Disable secondary indexes
ALTER TABLE t1 DISABLE KEYS;
# Bulk insert with indexes disabled
SELECT COUNT(*) FROM t1;
COUNT(*)
200
# Re-enable and rebuild indexes
ALTER TABLE t1 ENABLE KEYS;
# Verify secondary index works after rebuild
SELECT COUNT(*) FROM t1 WHERE name = 'name_100';
COUNT(*)
1
SELECT COUNT(*) FROM t1 WHERE value = 500;
COUNT(*)
1
SELECT * FROM t1 WHERE name = 'name_1' ORDER BY id;
id	name	value
1	name_1	10
# Test 2: Verify index scan works after rebuild
EXPLAIN SELECT * FROM t1 WHERE name = 'name_50';
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
#	#	#	#	#	#	#	#	#	#
# Test 3: Disable/enable on table with no secondary indexes (no-op)
CREATE TABLE t2 (
id INT PRIMARY KEY,
data VARCHAR(255)
) ENGINE=TidesDB;
ALTER TABLE t2 DISABLE KEYS;
INSERT INTO t2 VALUES (1, 'test');
ALTER TABLE t2 ENABLE KEYS;
SELECT * FROM t2;
id	data
1	test
# Test 4: Multiple disable/enable cycles
CREATE TABLE t3 (
id INT PRIMARY KEY,
val INT,
INDEX idx_val (val)
) ENGINE=TidesDB;
ALTER TABLE t3 DISABLE KEYS;
INSERT INTO t3 VALUES (1, 10), (2, 20), (3, 30);
ALTER TABLE t3 ENABLE KEYS;
SELECT * FROM t3 WHERE val = 20;
id	val
2	20
ALTER TABLE t3 DISABLE KEYS;
INSERT INTO t3 VALUES (4, 40), (5, 50);
ALTER TABLE t3 ENABLE KEYS;
SELECT COUNT(*) FROM t3;
COUNT(*)
5
SELECT * FROM t3 WHERE val >= 30 ORDER BY id;
id	val
3	30
4	40
5	50
# Cleanup
DROP TABLE t1, t2, t3;
#
# Disable/enable indexes tests completed!
#
