#
# TidesDB DDL Tests
#
# Tests for ALTER TABLE operations:
# - ADD/DROP COLUMN
# - ADD/DROP INDEX
#
DROP TABLE IF EXISTS tidesdb_check;
# Test 1: Basic table creation with index
CREATE TABLE t1 (
id INT PRIMARY KEY,
name VARCHAR(100),
email VARCHAR(100),
INDEX idx_name (name)
) ENGINE=TidesDB;
Warnings:
Note	1071	Specified key was too long; max key length is 255 bytes
INSERT INTO t1 VALUES (1, 'Alice', 'alice@example.com');
INSERT INTO t1 VALUES (2, 'Bob', 'bob@example.com');
INSERT INTO t1 VALUES (3, 'Charlie', 'charlie@example.com');
SELECT * FROM t1 ORDER BY id;
id	name	email
1	Alice	alice@example.com
2	Bob	bob@example.com
3	Charlie	charlie@example.com
# Test 2: ADD COLUMN
ALTER TABLE t1 ADD COLUMN age INT;
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `id` int(11) NOT NULL,
  `name` varchar(100) DEFAULT NULL,
  `email` varchar(100) DEFAULT NULL,
  `age` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `idx_name` (`name`(63))
) ENGINE=TidesDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_uca1400_ai_ci
# Verify existing data is preserved
SELECT * FROM t1 ORDER BY id;
id	name	email	age
1	Alice	alice@example.com	NULL
2	Bob	bob@example.com	NULL
3	Charlie	charlie@example.com	NULL
# Update with new column
UPDATE t1 SET age = 25 WHERE id = 1;
UPDATE t1 SET age = 30 WHERE id = 2;
UPDATE t1 SET age = 35 WHERE id = 3;
SELECT * FROM t1 ORDER BY id;
id	name	email	age
1	Alice	alice@example.com	25
2	Bob	bob@example.com	30
3	Charlie	charlie@example.com	35
# Test 3: ADD COLUMN with DEFAULT
ALTER TABLE t1 ADD COLUMN status VARCHAR(20) DEFAULT 'active';
SELECT * FROM t1 ORDER BY id;
id	name	email	age	status
1	Alice	alice@example.com	25	active
2	Bob	bob@example.com	30	active
3	Charlie	charlie@example.com	35	active
# Test 4: DROP COLUMN
ALTER TABLE t1 DROP COLUMN status;
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `id` int(11) NOT NULL,
  `name` varchar(100) DEFAULT NULL,
  `email` varchar(100) DEFAULT NULL,
  `age` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `idx_name` (`name`(63))
) ENGINE=TidesDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_uca1400_ai_ci
SELECT * FROM t1 ORDER BY id;
id	name	email	age
1	Alice	alice@example.com	25
2	Bob	bob@example.com	30
3	Charlie	charlie@example.com	35
# Test 5: Verify index still works
SELECT * FROM t1 WHERE name = 'Alice';
id	name	email	age
1	Alice	alice@example.com	25
# Test 6: Insert more data
INSERT INTO t1 VALUES (4, 'David', 'david@example.com', 40);
INSERT INTO t1 VALUES (5, 'Eve', 'eve@example.com', 28);
SELECT * FROM t1 ORDER BY id;
id	name	email	age
1	Alice	alice@example.com	25
2	Bob	bob@example.com	30
3	Charlie	charlie@example.com	35
4	David	david@example.com	40
5	Eve	eve@example.com	28
# Cleanup
DROP TABLE t1;
#
# DDL tests completed!
#
