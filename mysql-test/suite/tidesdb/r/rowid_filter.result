#
# TidesDB Rowid Filter Pushdown Tests
#
# Tests that rowid_filter_push() is accepted by the engine
# and semi-join queries work correctly.
#
DROP TABLE IF EXISTS tidesdb_check;
# Test 1: Create tables for semi-join test
CREATE TABLE t1 (
id INT PRIMARY KEY,
a INT,
b INT,
INDEX idx_a (a),
INDEX idx_b (b)
) ENGINE=TidesDB;
CREATE TABLE t2 (
id INT PRIMARY KEY,
x INT,
INDEX idx_x (x)
) ENGINE=TidesDB;
# Test 2: Populate data
# Test 3: Semi-join query (IN subquery)
SELECT COUNT(*) FROM t1 WHERE a IN (SELECT x FROM t2 WHERE x < 5);
COUNT(*)
50
# Test 4: Semi-join with multiple conditions
SELECT COUNT(*) FROM t1 WHERE a IN (SELECT x FROM t2) AND b < 3;
COUNT(*)
44
# Test 5: EXISTS subquery
SELECT COUNT(*) FROM t1 WHERE EXISTS (SELECT 1 FROM t2 WHERE t2.x = t1.a);
COUNT(*)
100
# Test 6: NOT IN subquery
SELECT COUNT(*) FROM t1 WHERE a NOT IN (SELECT x FROM t2 WHERE x > 7);
COUNT(*)
80
# Test 7: Correlated subquery
SELECT COUNT(*) FROM t1 WHERE a = (SELECT MIN(x) FROM t2);
COUNT(*)
10
# Test 8: Join with index usage
SELECT COUNT(*) FROM t1 JOIN t2 ON t1.a = t2.x WHERE t2.x < 5;
COUNT(*)
100
# Cleanup
DROP TABLE t1, t2;
#
# Rowid filter tests completed!
#
