#
# TidesDB estimate_rows_upper_bound() and Query Cache Tests
#
DROP TABLE IF EXISTS tidesdb_check;
# Test 1: Row estimate on empty table
CREATE TABLE t1 (
id INT PRIMARY KEY,
data VARCHAR(255)
) ENGINE=TidesDB;
# Empty table should report 0 or small number
SELECT TABLE_ROWS FROM information_schema.tables
WHERE table_schema = DATABASE() AND table_name = 't1';
TABLE_ROWS
0
# Test 2: Row estimate after inserts
# Should report approximately 100 rows
# TABLE_ROWS is approximately 100
# Verify actual count matches
SELECT COUNT(*) FROM t1;
COUNT(*)
100
# Test 3: Row estimate after deletes
DELETE FROM t1 WHERE id > 50;
SELECT COUNT(*) FROM t1;
COUNT(*)
50
# Test 4: Row estimate with secondary index
CREATE TABLE t2 (
id INT PRIMARY KEY,
name VARCHAR(100),
INDEX idx_name (name)
) ENGINE=TidesDB;
Warnings:
Note	1071	Specified key was too long; max key length is 255 bytes
SELECT COUNT(*) FROM t2;
COUNT(*)
200
# EXPLAIN should show reasonable row estimates
EXPLAIN SELECT * FROM t2 WHERE name = 'name_5';
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
#	#	#	#	#	#	#	#	#	#
# Test 5: Join with row estimates affecting plan
CREATE TABLE t3 (
id INT PRIMARY KEY,
val INT
) ENGINE=TidesDB;
INSERT INTO t3 VALUES (1, 10), (2, 20), (3, 30);
EXPLAIN SELECT * FROM t2 JOIN t3 ON t2.id = t3.id;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
#	#	#	#	#	#	#	#	#	#
#	#	#	#	#	#	#	#	#	#
# Cleanup
DROP TABLE t1, t2, t3;
#
# Row estimate tests completed!
#
