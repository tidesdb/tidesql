--echo #
--echo # TidesDB DDL (Data Definition Language) Tests
--echo #

# Check if TidesDB is available
--disable_query_log
--error 0,1286
CREATE TABLE tidesdb_check (id INT) ENGINE=TidesDB;
--enable_query_log
if (`SELECT COUNT(*) = 0 FROM information_schema.tables WHERE table_name = 'tidesdb_check'`)
{
  --skip TidesDB storage engine not available
}
DROP TABLE IF EXISTS tidesdb_check;

--echo # Test 1: CREATE TABLE with various constraints
CREATE TABLE t1 (
  id INT PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  email VARCHAR(100),
  age INT DEFAULT 0,
  INDEX idx_email (email)
) ENGINE=TidesDB;

SHOW CREATE TABLE t1;

--echo # Test 2: RENAME TABLE
RENAME TABLE t1 TO t1_renamed;
SHOW TABLES LIKE 't1%';
RENAME TABLE t1_renamed TO t1;

--echo # Test 3: DROP TABLE
INSERT INTO t1 VALUES (1, 'Test', 'test@example.com', 25);
SELECT * FROM t1;
DROP TABLE t1;
--error 1146
SELECT * FROM t1;

--echo # Test 4: CREATE TABLE with composite primary key
CREATE TABLE t2 (
  part1 INT,
  part2 INT,
  data VARCHAR(100),
  PRIMARY KEY (part1, part2)
) ENGINE=TidesDB;

INSERT INTO t2 VALUES (1, 1, 'data1');
INSERT INTO t2 VALUES (1, 2, 'data2');
INSERT INTO t2 VALUES (2, 1, 'data3');
SELECT * FROM t2 ORDER BY part1, part2;

--echo # Test 5: CREATE TABLE without primary key (hidden PK)
CREATE TABLE t3 (
  name VARCHAR(100),
  value INT
) ENGINE=TidesDB;

INSERT INTO t3 VALUES ('row1', 1);
INSERT INTO t3 VALUES ('row2', 2);
INSERT INTO t3 VALUES ('row1', 3);
SELECT * FROM t3 ORDER BY value;

--echo # Test 6: TRUNCATE TABLE
INSERT INTO t3 VALUES ('row4', 4);
SELECT COUNT(*) FROM t3;
TRUNCATE TABLE t3;
SELECT COUNT(*) FROM t3;

--echo # Test 7: CREATE TABLE with multiple indexes
CREATE TABLE t4 (
  id INT PRIMARY KEY,
  col1 VARCHAR(50),
  col2 INT,
  col3 DATE,
  INDEX idx1 (col1),
  INDEX idx2 (col2),
  INDEX idx3 (col3),
  INDEX idx_composite (col1, col2)
) ENGINE=TidesDB;

SHOW INDEX FROM t4;

--echo # Test 8: CREATE TABLE IF NOT EXISTS
CREATE TABLE IF NOT EXISTS t4 (id INT);
SHOW WARNINGS;

--echo # Test 9: DROP TABLE IF EXISTS
DROP TABLE IF EXISTS nonexistent_table;
SHOW WARNINGS;

--echo # Cleanup
DROP TABLE t2, t3, t4;

--echo #
--echo # DDL tests completed!
--echo #
