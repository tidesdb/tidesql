--echo #
--echo # TidesDB Encryption Configuration Tests
--echo #
--echo # Tests for encryption configuration variables.
--echo # Note: Actual encryption requires a key management plugin.
--echo #

# Check if TidesDB is available
--disable_query_log
--error 0,1286
CREATE TABLE tidesdb_check (id INT) ENGINE=TidesDB;
--enable_query_log
if (`SELECT COUNT(*) = 0 FROM information_schema.tables WHERE table_name = 'tidesdb_check'`)
{
  --skip TidesDB storage engine not available
}
DROP TABLE IF EXISTS tidesdb_check;

--echo # Test 1: Show encryption configuration variables
SHOW VARIABLES LIKE 'tidesdb_enable_encryption';
SHOW VARIABLES LIKE 'tidesdb_encryption_key_id';

--echo # Test 2: Create table and verify data integrity (encryption disabled)
CREATE TABLE t1 (
  id INT PRIMARY KEY,
  name VARCHAR(100),
  secret_data VARCHAR(255),
  amount DECIMAL(10,2)
) ENGINE=TidesDB;

INSERT INTO t1 VALUES (1, 'Alice', 'Secret message 1', 1000.50);
INSERT INTO t1 VALUES (2, 'Bob', 'Secret message 2', 2500.75);
INSERT INTO t1 VALUES (3, 'Charlie', 'Secret message 3', 3750.25);

SELECT * FROM t1 ORDER BY id;

--echo # Test 3: Update and verify
UPDATE t1 SET secret_data = 'Updated secret', amount = 9999.99 WHERE id = 1;
SELECT * FROM t1 WHERE id = 1;

--echo # Test 4: Delete and re-insert
DELETE FROM t1 WHERE id = 2;
INSERT INTO t1 VALUES (2, 'Bob New', 'New secret for Bob', 5000.00);
SELECT * FROM t1 ORDER BY id;

--echo # Test 5: Large data handling
CREATE TABLE t2 (
  id INT PRIMARY KEY,
  large_text TEXT
) ENGINE=TidesDB;

INSERT INTO t2 VALUES (1, REPEAT('A', 10000));
INSERT INTO t2 VALUES (2, REPEAT('B', 50000));

SELECT id, LENGTH(large_text) FROM t2 ORDER BY id;
SELECT id, LEFT(large_text, 10) FROM t2 ORDER BY id;

--echo # Test 6: Transactions
START TRANSACTION;
INSERT INTO t1 VALUES (10, 'Trans1', 'Transaction data 1', 100.00);
INSERT INTO t1 VALUES (11, 'Trans2', 'Transaction data 2', 200.00);
COMMIT;

SELECT * FROM t1 WHERE id >= 10 ORDER BY id;

START TRANSACTION;
INSERT INTO t1 VALUES (12, 'Trans3', 'Transaction data 3', 300.00);
ROLLBACK;

SELECT * FROM t1 WHERE id >= 10 ORDER BY id;

--echo # Cleanup
DROP TABLE t1;
DROP TABLE t2;

--echo #
--echo # Encryption configuration tests completed!
--echo #
