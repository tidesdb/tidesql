--echo #
--echo # TidesDB Edge Cases and Error Handling Tests
--echo #

# Check if TidesDB is available
--disable_query_log
--error 0,1286
CREATE TABLE tidesdb_check (id INT) ENGINE=TidesDB;
--enable_query_log
if (`SELECT COUNT(*) = 0 FROM information_schema.tables WHERE table_name = 'tidesdb_check'`)
{
  --skip TidesDB storage engine not available
}
DROP TABLE IF EXISTS tidesdb_check;

--echo # Test 1: Empty table operations
CREATE TABLE t1 (
  id INT PRIMARY KEY,
  name VARCHAR(100)
) ENGINE=TidesDB;

SELECT COUNT(*) FROM t1;
SELECT * FROM t1;
DELETE FROM t1;
TRUNCATE TABLE t1;

--echo # Test 2: Large VARCHAR values
INSERT INTO t1 VALUES (1, REPEAT('A', 100));
SELECT id, LENGTH(name) FROM t1;

--echo # Test 3: NULL handling
DROP TABLE t1;
CREATE TABLE t1 (
  id INT PRIMARY KEY,
  name VARCHAR(100),
  value INT
) ENGINE=TidesDB;

INSERT INTO t1 VALUES (1, NULL, NULL);
INSERT INTO t1 VALUES (2, 'Bob', NULL);
INSERT INTO t1 VALUES (3, NULL, 300);
INSERT INTO t1 VALUES (4, 'Dave', 400);

SELECT * FROM t1 ORDER BY id;
SELECT * FROM t1 WHERE name IS NULL ORDER BY id;
SELECT * FROM t1 WHERE value IS NULL ORDER BY id;
SELECT * FROM t1 WHERE name IS NOT NULL ORDER BY id;

--echo # Test 4: UPDATE to NULL
UPDATE t1 SET name = NULL WHERE id = 4;
SELECT * FROM t1 ORDER BY id;

--echo # Test 5: Duplicate key error
--error ER_DUP_KEY
INSERT INTO t1 VALUES (1, 'Duplicate', 999);

--echo # Test 6: Very long table name (skipped - identifier length varies by platform)

--echo # Test 7: Boundary values for INT
DROP TABLE t1;
CREATE TABLE t1 (
  id INT PRIMARY KEY,
  val_int INT,
  val_bigint BIGINT
) ENGINE=TidesDB;

INSERT INTO t1 VALUES (1, 2147483647, 9223372036854775807);
INSERT INTO t1 VALUES (2, -2147483648, -9223372036854775808);
INSERT INTO t1 VALUES (3, 0, 0);
SELECT * FROM t1 ORDER BY id;

--echo # Test 8: Empty string vs NULL
DROP TABLE t1;
CREATE TABLE t1 (
  id INT PRIMARY KEY,
  name VARCHAR(100)
) ENGINE=TidesDB;

INSERT INTO t1 VALUES (1, '');
INSERT INTO t1 VALUES (2, NULL);
INSERT INTO t1 VALUES (3, ' ');

SELECT id, name, LENGTH(name), name IS NULL FROM t1 ORDER BY id;

--echo # Test 9: Case sensitivity in LIKE
INSERT INTO t1 VALUES (4, 'Alice');
INSERT INTO t1 VALUES (5, 'ALICE');
INSERT INTO t1 VALUES (6, 'alice');

SELECT * FROM t1 WHERE name LIKE 'Alice' ORDER BY id;
SELECT * FROM t1 WHERE name LIKE 'alice' ORDER BY id;
SELECT * FROM t1 WHERE name LIKE '%lice%' ORDER BY id;

--echo # Test 10: ORDER BY with NULL values
SELECT * FROM t1 ORDER BY name ASC;
SELECT * FROM t1 ORDER BY name DESC;

--echo # Cleanup
DROP TABLE t1;

--echo #
--echo # Edge cases tests completed!
--echo #
