--echo #
--echo # TidesDB Bulk Insert Tests
--echo #

# Check if TidesDB is available
--disable_query_log
--error 0,1286
CREATE TABLE tidesdb_check (id INT) ENGINE=TidesDB;
--enable_query_log
if (`SELECT COUNT(*) = 0 FROM information_schema.tables WHERE table_name = 'tidesdb_check'`)
{
  --skip TidesDB storage engine not available
}
DROP TABLE IF EXISTS tidesdb_check;

--echo # Test 1: LOAD DATA style bulk insert
CREATE TABLE t1 (
  id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(100),
  value INT
) ENGINE=TidesDB;

--echo # Test 2: INSERT ... SELECT bulk insert
CREATE TABLE t2 (
  id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(100),
  value INT
) ENGINE=TidesDB;

INSERT INTO t1 (name, value) VALUES ('row1', 1), ('row2', 2), ('row3', 3);
INSERT INTO t1 (name, value) VALUES ('row4', 4), ('row5', 5), ('row6', 6);
INSERT INTO t1 (name, value) VALUES ('row7', 7), ('row8', 8), ('row9', 9);

INSERT INTO t2 SELECT * FROM t1;
SELECT COUNT(*) FROM t2;

--echo # Test 3: Large multi-row INSERT
CREATE TABLE t3 (
  id INT PRIMARY KEY,
  data VARCHAR(255)
) ENGINE=TidesDB;

--disable_query_log
let $i = 1;
while ($i <= 100)
{
  eval INSERT INTO t3 VALUES ($i, CONCAT('data_', $i));
  inc $i;
}
--enable_query_log

SELECT COUNT(*) FROM t3;
SELECT * FROM t3 WHERE id IN (1, 50, 100);

--echo # Test 4: Bulk insert with secondary index
CREATE TABLE t4 (
  id INT PRIMARY KEY,
  indexed_col VARCHAR(50),
  INDEX idx_col (indexed_col)
) ENGINE=TidesDB;

--disable_query_log
let $i = 1;
while ($i <= 50)
{
  eval INSERT INTO t4 VALUES ($i, CONCAT('value_', $i MOD 10));
  inc $i;
}
--enable_query_log

SELECT COUNT(*) FROM t4;
SELECT COUNT(*) FROM t4 WHERE indexed_col = 'value_5';

--echo # Test 5: Bulk insert with auto-increment
CREATE TABLE t5 (
  id INT AUTO_INCREMENT PRIMARY KEY,
  data VARCHAR(100)
) ENGINE=TidesDB;

INSERT INTO t5 (data) VALUES ('a'), ('b'), ('c'), ('d'), ('e');
INSERT INTO t5 (data) VALUES ('f'), ('g'), ('h'), ('i'), ('j');
SELECT * FROM t5 ORDER BY id;
SELECT MAX(id) FROM t5;

--echo # Cleanup
DROP TABLE t1, t2, t3, t4, t5;

--echo #
--echo # Bulk insert tests completed!
--echo #
