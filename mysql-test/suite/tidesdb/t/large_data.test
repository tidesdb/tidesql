--echo #
--echo # TidesDB Large Data Tests
--echo #
--echo # Tests for handling larger datasets and BLOB/TEXT types
--echo #

# Check if TidesDB is available
--disable_query_log
--error 0,1286
CREATE TABLE tidesdb_check (id INT) ENGINE=TidesDB;
--enable_query_log
if (`SELECT COUNT(*) = 0 FROM information_schema.tables WHERE table_name = 'tidesdb_check'`)
{
  --skip TidesDB storage engine not available
}
DROP TABLE IF EXISTS tidesdb_check;

--echo # Test 1: TEXT column
CREATE TABLE t1 (
  id INT PRIMARY KEY,
  content TEXT
) ENGINE=TidesDB;

INSERT INTO t1 VALUES (1, REPEAT('Hello World ', 100));
INSERT INTO t1 VALUES (2, REPEAT('Test data ', 500));
INSERT INTO t1 VALUES (3, NULL);

SELECT id, LENGTH(content) FROM t1 ORDER BY id;

--echo # Test 2: BLOB column
DROP TABLE t1;
CREATE TABLE t1 (
  id INT PRIMARY KEY,
  data BLOB
) ENGINE=TidesDB;

INSERT INTO t1 VALUES (1, REPEAT('A', 1000));
INSERT INTO t1 VALUES (2, REPEAT('B', 5000));
INSERT INTO t1 VALUES (3, NULL);

SELECT id, LENGTH(data) FROM t1 ORDER BY id;

--echo # Test 3: Multiple BLOB/TEXT columns
DROP TABLE t1;
CREATE TABLE t1 (
  id INT PRIMARY KEY,
  text1 TEXT,
  blob1 BLOB,
  text2 MEDIUMTEXT
) ENGINE=TidesDB;

INSERT INTO t1 VALUES (1, REPEAT('T', 100), REPEAT('B', 200), REPEAT('M', 300));
SELECT id, LENGTH(text1), LENGTH(blob1), LENGTH(text2) FROM t1;

--echo # Test 4: UPDATE BLOB/TEXT
UPDATE t1 SET text1 = REPEAT('X', 500) WHERE id = 1;
SELECT id, LENGTH(text1), LENGTH(blob1), LENGTH(text2) FROM t1;

--echo # Test 5: Batch insert
DROP TABLE t1;
CREATE TABLE t1 (
  id INT PRIMARY KEY,
  name VARCHAR(100),
  value INT
) ENGINE=TidesDB;

--disable_query_log
let $i = 1;
while ($i <= 100)
{
  eval INSERT INTO t1 VALUES ($i, CONCAT('Name_', $i), $i * 10);
  inc $i;
}
--enable_query_log

SELECT COUNT(*) FROM t1;
SELECT MIN(id), MAX(id), MIN(value), MAX(value) FROM t1;

--echo # Test 6: Range queries on larger dataset
SELECT COUNT(*) FROM t1 WHERE id BETWEEN 25 AND 75;
SELECT COUNT(*) FROM t1 WHERE value >= 500;

--echo # Test 7: DELETE range
DELETE FROM t1 WHERE id BETWEEN 40 AND 60;
SELECT COUNT(*) FROM t1;

--echo # Cleanup
DROP TABLE t1;

--echo #
--echo # Large data tests completed!
--echo #
