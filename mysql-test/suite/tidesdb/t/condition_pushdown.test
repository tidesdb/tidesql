--echo #
--echo # Test Table Condition Pushdown (HA_CAN_TABLE_CONDITION_PUSHDOWN)
--echo #

# Check if TidesDB is available
--disable_query_log
--error 0,1286
CREATE TABLE tidesdb_check (id INT) ENGINE=TidesDB;
--enable_query_log
if (`SELECT COUNT(*) = 0 FROM information_schema.tables WHERE table_name = 'tidesdb_check'`)
{
  --skip TidesDB storage engine not available
}
DROP TABLE tidesdb_check;

# Create test table
CREATE TABLE t1 (
  id INT PRIMARY KEY,
  a INT,
  b INT,
  c VARCHAR(100)
) ENGINE=TidesDB;

# Insert test data
INSERT INTO t1 VALUES (1, 10, 100, 'row1');
INSERT INTO t1 VALUES (2, 20, 200, 'row2');
INSERT INTO t1 VALUES (3, 30, 300, 'row3');
INSERT INTO t1 VALUES (4, 40, 400, 'row4');
INSERT INTO t1 VALUES (5, 50, 500, 'row5');
INSERT INTO t1 VALUES (6, 60, 600, 'row6');
INSERT INTO t1 VALUES (7, 70, 700, 'row7');
INSERT INTO t1 VALUES (8, 80, 800, 'row8');
INSERT INTO t1 VALUES (9, 90, 900, 'row9');
INSERT INTO t1 VALUES (10, 100, 1000, 'row10');

--echo # Test 1: Simple condition pushdown on table scan
EXPLAIN SELECT * FROM t1 WHERE a > 50;
SELECT * FROM t1 WHERE a > 50 ORDER BY id;

--echo # Test 2: Multiple conditions
EXPLAIN SELECT * FROM t1 WHERE a > 30 AND b < 700;
SELECT * FROM t1 WHERE a > 30 AND b < 700 ORDER BY id;

--echo # Test 3: String condition
EXPLAIN SELECT * FROM t1 WHERE c LIKE 'row%';
SELECT * FROM t1 WHERE c LIKE 'row1%' ORDER BY id;

--echo # Test 4: OR condition
SELECT * FROM t1 WHERE a = 20 OR a = 80 ORDER BY id;

--echo # Test 5: IN condition
SELECT * FROM t1 WHERE a IN (10, 30, 50, 70, 90) ORDER BY id;

--echo # Test 6: BETWEEN condition
SELECT * FROM t1 WHERE b BETWEEN 300 AND 700 ORDER BY id;

--echo # Test 7: Complex condition
SELECT * FROM t1 WHERE (a > 30 AND b < 600) OR c = 'row9' ORDER BY id;

--echo # Cleanup
DROP TABLE t1;

--echo #
--echo # Condition pushdown tests completed!
--echo #
