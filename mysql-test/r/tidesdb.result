drop table if exists t1,t2,t3;
SET SQL_WARNINGS=1;
# Test: Basic CREATE TABLE with TidesDB
CREATE TABLE t1 (
id INT NOT NULL AUTO_INCREMENT,
name VARCHAR(100),
value INT,
PRIMARY KEY (id)
) ENGINE=TidesDB;
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(100) DEFAULT NULL,
  `value` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=TidesDB DEFAULT CHARSET=latin1
# Test: INSERT operations
INSERT INTO t1 (name, value) VALUES ('test1', 100);
INSERT INTO t1 (name, value) VALUES ('test2', 200);
INSERT INTO t1 (name, value) VALUES ('test3', 300);
SELECT * FROM t1 ORDER BY id;
id	name	value
1	test1	100
2	test2	200
3	test3	300
# Test: UPDATE operations
UPDATE t1 SET value = 150 WHERE id = 1;
SELECT * FROM t1 WHERE id = 1;
id	name	value
1	test1	150
# Test: DELETE operations
DELETE FROM t1 WHERE id = 2;
SELECT * FROM t1 ORDER BY id;
id	name	value
1	test1	150
3	test3	300
# Test: Auto-increment
INSERT INTO t1 (name, value) VALUES ('test4', 400);
SELECT * FROM t1 ORDER BY id;
id	name	value
1	test1	150
3	test3	300
4	test4	400
DROP TABLE t1;
# Test: Various data types
CREATE TABLE t2 (
id INT NOT NULL AUTO_INCREMENT,
tiny_col TINYINT,
small_col SMALLINT,
medium_col MEDIUMINT,
big_col BIGINT,
float_col FLOAT,
double_col DOUBLE,
decimal_col DECIMAL(10,2),
char_col CHAR(50),
varchar_col VARCHAR(255),
text_col TEXT,
blob_col BLOB,
date_col DATE,
datetime_col DATETIME,
timestamp_col TIMESTAMP,
PRIMARY KEY (id)
) ENGINE=TidesDB;
INSERT INTO t2 (tiny_col, small_col, medium_col, big_col, float_col, double_col, 
decimal_col, char_col, varchar_col, text_col, blob_col, 
date_col, datetime_col, timestamp_col)
VALUES (127, 32767, 8388607, 9223372036854775807, 3.14, 3.14159265359,
12345.67, 'char data', 'varchar data', 'text data', 'blob data',
'2024-01-15', '2024-01-15 10:30:00', '2024-01-15 10:30:00');
SELECT * FROM t2;
id	tiny_col	small_col	medium_col	big_col	float_col	double_col	decimal_col	char_col	varchar_col	text_col	blob_col	date_col	datetime_col	timestamp_col
1	127	32767	8388607	9223372036854775807	3.14	3.14159265359	12345.67	char data	varchar data	text data	blob data	2024-01-15	2024-01-15 10:30:00	2024-01-15 10:30:00
DROP TABLE t2;
# Test: Table scan with multiple rows
CREATE TABLE t3 (
id INT NOT NULL AUTO_INCREMENT,
data VARCHAR(100),
PRIMARY KEY (id)
) ENGINE=TidesDB;
SELECT COUNT(*) FROM t3;
COUNT(*)
100
SELECT * FROM t3 WHERE id = 50;
id	data
50	row_51
SELECT * FROM t3 WHERE id BETWEEN 10 AND 20 ORDER BY id;
id	data
10	row_91
11	row_90
12	row_89
13	row_88
14	row_87
15	row_86
16	row_85
17	row_84
18	row_83
19	row_82
20	row_81
DROP TABLE t3;
# Test: CHECK TABLE
CREATE TABLE t1 (
id INT NOT NULL AUTO_INCREMENT,
data VARCHAR(100),
PRIMARY KEY (id)
) ENGINE=TidesDB;
INSERT INTO t1 (data) VALUES ('check test 1'), ('check test 2');
CHECK TABLE t1;
Table	Op	Msg_type	Msg_text
test.t1	check	status	OK
# Test: REPAIR TABLE
REPAIR TABLE t1;
Table	Op	Msg_type	Msg_text
test.t1	repair	status	OK
# Test: OPTIMIZE TABLE
OPTIMIZE TABLE t1;
Table	Op	Msg_type	Msg_text
test.t1	optimize	status	OK
# Test: ANALYZE TABLE
ANALYZE TABLE t1;
Table	Op	Msg_type	Msg_text
test.t1	analyze	status	OK
DROP TABLE t1;
# Test: Bulk insert performance
CREATE TABLE t1 (
id INT NOT NULL AUTO_INCREMENT,
data VARCHAR(255),
PRIMARY KEY (id)
) ENGINE=TidesDB;
SELECT COUNT(*) FROM t1;
COUNT(*)
1000
DROP TABLE t1;
# Test: NULL values
CREATE TABLE t1 (
id INT NOT NULL AUTO_INCREMENT,
nullable_col VARCHAR(100),
PRIMARY KEY (id)
) ENGINE=TidesDB;
INSERT INTO t1 (nullable_col) VALUES ('not null');
INSERT INTO t1 (nullable_col) VALUES (NULL);
INSERT INTO t1 (nullable_col) VALUES ('also not null');
SELECT * FROM t1 ORDER BY id;
id	nullable_col
1	not null
2	NULL
3	also not null
SELECT * FROM t1 WHERE nullable_col IS NULL;
id	nullable_col
2	NULL
SELECT * FROM t1 WHERE nullable_col IS NOT NULL ORDER BY id;
id	nullable_col
1	not null
3	also not null
DROP TABLE t1;
# Test: DELETE all rows
CREATE TABLE t1 (
id INT NOT NULL AUTO_INCREMENT,
data VARCHAR(100),
PRIMARY KEY (id)
) ENGINE=TidesDB;
INSERT INTO t1 (data) VALUES ('row1'), ('row2'), ('row3');
SELECT COUNT(*) FROM t1;
COUNT(*)
3
DELETE FROM t1;
SELECT COUNT(*) FROM t1;
COUNT(*)
0
DROP TABLE t1;
# Test: RENAME TABLE
CREATE TABLE t1 (
id INT NOT NULL AUTO_INCREMENT,
data VARCHAR(100),
PRIMARY KEY (id)
) ENGINE=TidesDB;
INSERT INTO t1 (data) VALUES ('rename test');
SELECT * FROM t1;
id	data
1	rename test
RENAME TABLE t1 TO t2;
SELECT * FROM t2;
id	data
1	rename test
DROP TABLE t2;
# Test: Basic transaction support
CREATE TABLE t1 (
id INT NOT NULL AUTO_INCREMENT,
data VARCHAR(100),
PRIMARY KEY (id)
) ENGINE=TidesDB;
START TRANSACTION;
INSERT INTO t1 (data) VALUES ('txn row 1');
INSERT INTO t1 (data) VALUES ('txn row 2');
COMMIT;
SELECT * FROM t1 ORDER BY id;
id	data
1	txn row 1
2	txn row 2
START TRANSACTION;
INSERT INTO t1 (data) VALUES ('rollback row');
ROLLBACK;
SELECT * FROM t1 ORDER BY id;
id	data
1	txn row 1
2	txn row 2
DROP TABLE t1;
# All TidesDB tests passed!
